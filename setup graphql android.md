Setup Graphql Android


Android view > gradle scripts > module - add apply plugin and dependency and kotlin autogenerated
apply plugin: 'com.apollographql.apollo'
implementation 'com.apollographql.apollo:apollo-runtime:2.5.7'
apollo {
// instruct the compiler to generate Kotlin models
generateKotlinModels.set(true)
}

same > project > dependencies : add plugin
classpath 'com.apollographql.apollo:apollo-gradle-plugin:2.5.7'

sync project
Project view > download schema.json from server
./gradlew downloadApolloSchema \
--endpoint="https://graphql.indifi.com/graphql" \
--schema="app/src/main/graphql/com/example/schema.json"

Create .graphql file for query
Build > Rebuild Project
Go to any activity and declare okHttp for making request and ApolloClient for passing input
Make the hit

Sample Mutation


var graphUrl = UtilityFunctions.appendTimestampToUrl(AppConfig.GRAPHQL_SERVER_URL).toString()
var graphHeaders = UtilityFunctions.getHeaders(graphUrl, null)

val okHttp = OkHttpClient.Builder()
.addNetworkInterceptor { chain ->
val request = chain.request().newBuilder()
var newRequest = if(graphHeaders.containsKey("x-checksum")){
request.addHeader("x-checksum",graphHeaders.get("x-checksum")).build()
}else{
request.build()
}

chain.proceed(newRequest)
}
.build()

val apolloClient = ApolloClient.builder()
.serverUrl(graphUrl)
.okHttpClient(okHttp)
.build()

apolloClient.mutate(CreateLeadMutation(req=params))
.enqueue(object :ApolloCall.Callback<CreateLeadMutation.Data>(){
override fun onResponse(leadResponse: com.apollographql.apollo.api.Response<CreateLeadMutation.Data>) {

runOnUiThread {
// Include only the smallest amount of code possible, otherwise you start to defeat the purpose of the background thread.
Loader().stopLoader(progressBarHolder)
Toast.makeText(this@LoginActivity, "Please try again.", Toast.LENGTH_LONG).show()
}
// Success logic
}

override fun onFailure(e: ApolloException) {
runOnUiThread {
Loader().stopLoader(progressBarHolder)
Toast.makeText(this@LoginActivity, "Please try again.", Toast.LENGTH_LONG).show()
}
// failure logic
})


Sample Query


val apolloClient = ApolloClient.builder()
.serverUrl("https://graphql.indifi.com/graphql")
.build()
apolloClient.query(ServerTimeQuery())
.enqueue(object :ApolloCall.Callback<ServerTimeQuery.Data>(){
override fun onResponse(response: com.apollographql.apollo.api.Response<ServerTimeQuery.Data>) {
println("response gel - ${response.toString()}")
}
override fun onFailure(e: ApolloException) {
println("error gel - ${e.toString()}")
}
})
